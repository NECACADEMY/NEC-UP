<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Newings School Dashboard</title>

<style>
/* ---------- BASE ---------- */
*{box-sizing:border-box;margin:0;padding:0;font-family:Arial,sans-serif}
body{background:#f4f6f8;color:#1e3a8a;font-weight:bold;min-height:100vh}
.hidden{display:none}

/* ---------- HEADER ---------- */
header{background:#1e3a8a;color:#fff;padding:1rem;display:flex;justify-content:space-between;align-items:center}
header div{display:flex;align-items:center;gap:1rem}
header img{height:50px}
#logoutBtn{background:#facc15;border:none;padding:.5rem 1rem;border-radius:5px;font-weight:bold}

/* ---------- MAIN ---------- */
main{max-width:900px;margin:2rem auto;padding:1rem}

/* ---------- LOGIN ---------- */
#login-section{background:#fff;padding:2rem;border-radius:8px;box-shadow:0 4px 10px rgba(0,0,0,.1)}
#login-section input,#login-section button{width:100%;padding:.75rem;margin-top:1rem}
#login-section button{background:#1e3a8a;color:#fff;border:none}
.error{color:red;margin-top:.5rem}

/* ---------- TABS ---------- */
.tab{display:flex;margin:1rem 0}
.tab button{flex:1;padding:10px;border:none;background:#d0d0d0}
.tab button.active{background:#1e3a8a;color:#fff}
.tabcontent{display:none;background:#fff;padding:1rem;border-radius:8px}
.tabcontent.active{display:block}

/* ---------- FORMS ---------- */
label,select,input,textarea{width:100%;margin-top:10px;padding:10px}
button.submit{background:#1e3a8a;color:#fff;border:none;margin-top:15px;padding:12px;width:100%}

#saveMsg{margin-top:10px;color:green}
</style>
</head>

<body>

<header>
  <div>
    <img src="/images/schoollogo.png" alt="School Logo">
    <h1>Newings School Dashboard</h1>
  </div>
  <button id="logoutBtn" class="hidden">Logout</button>
</header>

<main>

<section id="login-section">
  <h2>Login</h2>
  <input id="email" type="email" placeholder="Email">
  <input id="password" type="password" placeholder="Password">
  <button onclick="login()">Login</button>
  <p id="loginError" class="error"></p>
</section>

<section id="dashboard" class="hidden">

  <div class="tab">
    <button class="tablink active" onclick="openTab('attendance',this)">Attendance</button>
    <button class="tablink" onclick="openTab('scores',this)">Scores</button>
    <button class="tablink" onclick="openTab('remarks',this)">Remarks</button>
  </div>

  <div id="attendance" class="tabcontent active">
    <label>Class</label><select id="attClass"></select>
    <label>Student</label><select id="attStudent"></select>
    <label>Status</label>
    <select id="attValue"><option>Present</option><option>Absent</option><option>Late</option></select>
    <button class="submit" onclick="submitAttendance()">Save Attendance</button>
  </div>

  <div id="scores" class="tabcontent">
    <label>Class</label><select id="scoreClass"></select>
    <label>Student</label><select id="scoreStudent"></select>
    <label>Subject</label><select id="scoreSubject"></select>
    <label>20%</label><input id="classScore" type="number">
    <label>30%</label><input id="midtermScore" type="number">
    <label>50%</label><input id="examScore" type="number">
    <button class="submit" onclick="submitScores()">Save Scores</button>
  </div>

  <div id="remarks" class="tabcontent">
    <label>Class</label><select id="remarkClass"></select>
    <label>Student</label><select id="remarkStudent"></select>
    <label>Conduct</label><select id="conduct"></select>
    <label>Remark</label><textarea id="teacherRemark"></textarea>
    <button class="submit" onclick="submitRemarks()">Save Remarks</button>
  </div>

  <div id="saveMsg"></div>

</section>
</main>

<script>
const BASE="";
let TOKEN=localStorage.getItem("token")||"";

const loginSection=document.getElementById("login-section");
const dashboard=document.getElementById("dashboard");
const logoutBtn=document.getElementById("logoutBtn");

function openTab(id,btn){
 document.querySelectorAll(".tabcontent").forEach(t=>t.classList.remove("active"));
 document.querySelectorAll(".tablink").forEach(b=>b.classList.remove("active"));
 document.getElementById(id).classList.add("active");
 btn.classList.add("active");
}

async function login(){
 const email=document.getElementById("email").value;
 const password=document.getElementById("password").value;

 const res=await fetch("/api/auth/login",{
  method:"POST",
  headers:{"Content-Type":"application/json"},
  body:JSON.stringify({email,password})
 });

 const data=await res.json();
 if(!res.ok) return document.getElementById("loginError").innerText=data.error;

 TOKEN=data.token;
 localStorage.setItem("token",TOKEN);

 loginSection.classList.add("hidden");
 dashboard.classList.remove("hidden");
 logoutBtn.classList.remove("hidden");
 loadStaticData();
}

logoutBtn.onclick=()=>{
 localStorage.clear();
 location.reload();
}

function loadStaticData(){
 const classes=["Creche","Nurs1","Nurs2","KG1","KG2","Stage1","Stage2","Stage3","Stage4","Stage5","Stage6"];
 ["attClass","scoreClass","remarkClass"].forEach(id=>{
  const sel=document.getElementById(id);
  sel.innerHTML='<option value="">Select Class</option>';
  classes.forEach(c=>sel.add(new Option(c,c)));
 });

 ["Math","English","Science"].forEach(s=>scoreSubject.add(new Option(s,s)));
 ["Excellent","Very Good","Good","Fair","Poor"].forEach(c=>conduct.add(new Option(c,c)));
}

if(TOKEN){
 loginSection.classList.add("hidden");
 dashboard.classList.remove("hidden");
 logoutBtn.classList.remove("hidden");
 loadStaticData();
}
</script>

</body>
</html>